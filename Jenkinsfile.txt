pipeline {
  agent any
  stages {

    stage('Production-deployment') {
      when {
        branch 'main' 
      }
      steps {
        script {
          // Adding a manual approval step with Yes and No options
          def userInput = input(
            message: 'Do you want to approve the deployment?',
            parameters: [
              choice(name: 'Approval', choices: ['Yes', 'No'], description: 'Approve or cancel the production deployment')
            ]
          )

          // Logic to handle the user input
          if (userInput == 'Yes') {
            echo "User approved the deployment. Proceeding with production deployment."

            sh """
              echo "Its success"
              #echo "DOCKER_IMAGE_TAG in Production-deployment: ${env.DOCKER_IMAGE_TAG}" 
              #echo "ecrRepoUrl in Production-deployment: ${env.ecrRepoUrl}" 
              #sed -i "s#123456786523.dkr.ecr.us-west-2.amazonaws.com/sim-ecr:<image-tag>#${env.ecrRepoUrl}:${env.DOCKER_IMAGE_TAG}#g" k8s-manifests/deployment-prod.yml  

              #/opt/kubectleks/kubectl --kubeconfig $KUBE_CONFIG apply -f k8s-manifests/deployment-prod.yml
            """
          } else {
            echo "User did not approve the deployment. Skipping production deployment."
          }
        }
      }
    }
  }
}
